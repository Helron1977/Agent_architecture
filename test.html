<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Architecture IA 3D - Three.js</title>
  <style>
    body { margin: 0; overflow: hidden; }
    #container { width: 100vw; height: 100vh; }
    .label {
      position: absolute;
      color: black;
      font-family: Arial, sans-serif;
      font-size: 14px;
      pointer-events: none;
      user-select: none;
    }
  </style>
</head>
<body>
  <div id="container"></div>

  <!-- Three.js -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>
  <!-- OrbitControls (UMD global) -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.153.0/examples/js/controls/OrbitControls.js"></script>


  <script>
    const container = document.getElementById('container');

    // Setup scene, camera, renderer
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0, 150, 300);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    container.appendChild(renderer.domElement);

    // Controls
    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    // Colors by group
    const colors = {
      perception: 0xa0c4ff,
      cognition: 0xb9fbc0,
      evaluation: 0xffd6a5,
      action: 0xffadad
    };

    // Levels with nodes
    const levels = {
      perception: { z: 0, nodes: ['P1', 'P2', 'P3', 'P4'] },
      cognition: { z: -100, nodes: ['C1', 'C2', 'C3', 'C4'] },
      evaluation: { z: -200, nodes: ['E1', 'E2'] },
      action: { z: -300, nodes: ['A1', 'A2'] },
    };

    // For labels
    const labels = [];

    // Function to position nodes in circle
    function positionNodesInCircle(nodes, radius, z) {
      return nodes.map((label, i) => {
        const angle = (i / nodes.length) * 2 * Math.PI;
        const x = Math.cos(angle) * radius;
        const y = Math.sin(angle) * radius;
        return { label, position: new THREE.Vector3(x, y, z) };
      });
    }

    // Create nodes with spheres and labels
    Object.entries(levels).forEach(([group, { z, nodes: nodeLabels }]) => {
      const radius = 50;
      const positioned = positionNodesInCircle(nodeLabels, radius, z);

      positioned.forEach(({ label, position }) => {
        // Sphere
        const geometry = new THREE.SphereGeometry(5, 32, 32);
        const material = new THREE.MeshBasicMaterial({ color: colors[group] });
        const sphere = new THREE.Mesh(geometry, material);
        sphere.position.copy(position);
        scene.add(sphere);

        // Create label div
        const div = document.createElement('div');
        div.className = 'label';
        div.textContent = label;
        document.body.appendChild(div);
        labels.push({ element: div, position });
      });
    });

    // Add Axes Helper
    const axesHelper = new THREE.AxesHelper(100);
    scene.add(axesHelper);

    // Animate and render loop
    function animate() {
      requestAnimationFrame(animate);
      controls.update();

      // Update label positions
      labels.forEach(({ element, position }) => {
        const vector = position.clone();
        vector.project(camera);

        const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
        const y = (-vector.y * 0.5 + 0.5) * window.innerHeight;

        element.style.transform = `translate(-50%, -50%) translate(${x}px,${y}px)`;
      });

      renderer.render(scene, camera);
    }

    animate();

    // Handle window resize
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
